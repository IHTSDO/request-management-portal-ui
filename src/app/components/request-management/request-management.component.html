<!--<div *ngIf="filterMenu" class="absolute right-0 left-0 top-0 bottom-0 bg-zinc-900 opacity-20" (click)="filterMenu = !filterMenu"></div>-->
<div class="text-sm mt-16">
    <div class="grid grid-cols-8 m-5">
        <div class="col-span-2 m-3">
            <h2 class="text-xl text-slate-700 p-2">{{ 'requestManagement.heading' | translate }} - {{ 'dashboard.countries.' + country | translate }}</h2>
        </div>
        <div class="col-span-4 m-3">
            <input class="text-slate-500 text-base w-full bg-gray-100 border rounded-full py-2 px-3 border-gray-300" [(ngModel)]="searchText" [placeholder]="'requestManagement.search' | translate" (input)="onSearchInput()">
        </div>
        <div class="col-span-2 m-3 justify-self-end">
            <button class="rounded-md bg-lime-600 text-white px-3 py-1.5 font-medium content-end tracking-widest cursor-pointer hover:bg-lime-700" (click)="navigateToNewRequest()" data-cy="new-request-button">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 inline text-lime-400 me-2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                </svg>{{ 'requestManagement.newRequestButton' | translate }}</button>
        </div>
    </div>
    <div class="border border-gray-300 m-5 rounded-lg">
        <table class="border-collapse table-auto w-full text-sm">
            <thead>
                <tr class="overflow-hidden">
                    <th class="bg-gray-100 border-b border-gray-300 font-normal text-sm p-2 text-start cursor-pointer" (click)="sortRequests('id')">
                        {{ 'requestManagement.id' | translate }}
                        <span *ngIf="sortColumn === 'id'">
                            <ng-container *ngIf="sortDirection === 'asc'">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4 inline-block">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18" />
                                </svg>
                            </ng-container>
                            <ng-container *ngIf="sortDirection === 'desc'">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4 inline-block">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 13.5 12 21m0 0-7.5-7.5M12 21V3" />
                                </svg>
                            </ng-container>
                        </span>
                    </th>
                    <th class="bg-gray-100 border-b border-gray-300 font-normal text-sm p-2 text-start cursor-pointer" (click)="sortRequests('summary')">
                        {{ 'requestManagement.request' | translate }}
                        <span *ngIf="sortColumn === 'summary'">
                            <ng-container *ngIf="sortDirection === 'asc'">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4 inline-block">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18" />
                                </svg>
                            </ng-container>
                            <ng-container *ngIf="sortDirection === 'desc'">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4 inline-block">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 13.5 12 21m0 0-7.5-7.5M12 21V3" />
                                </svg>
                            </ng-container>
                        </span>
                    </th>
                    <th class="bg-gray-100 border-b border-gray-300 font-normal text-sm p-2 text-start cursor-pointer" (click)="sortRequests('type')">
                        {{ 'requestManagement.type' | translate }}
                        <span *ngIf="sortColumn === 'type'">
                            <ng-container *ngIf="sortDirection === 'asc'">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4 inline-block">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18" />
                                </svg>
                            </ng-container>
                            <ng-container *ngIf="sortDirection === 'desc'">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4 inline-block">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 13.5 12 21m0 0-7.5-7.5M12 21V3" />
                                </svg>
                            </ng-container>
                        </span>
                    </th>
                    <th class="bg-gray-100 border-b border-gray-300 font-normal text-sm p-2 text-start cursor-pointer" (click)="sortRequests('status')">
                        {{ 'requestManagement.status' | translate }}
                        <span *ngIf="sortColumn === 'status'">
                            <ng-container *ngIf="sortDirection === 'asc'">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4 inline-block">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18" />
                                </svg>
                            </ng-container>
                            <ng-container *ngIf="sortDirection === 'desc'">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4 inline-block">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 13.5 12 21m0 0-7.5-7.5M12 21V3" />
                                </svg>
                            </ng-container>
                        </span>
                    </th>
                    <th class="bg-gray-100 border-b border-gray-300 font-normal text-sm p-2 text-start cursor-pointer" (click)="sortRequests('updatedDate')">
                        {{ 'requestManagement.updated' | translate }}
                        <span *ngIf="sortColumn === 'updatedDate'">
                            <ng-container *ngIf="sortDirection === 'asc'">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4 inline-block">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18" />
                                </svg>
                            </ng-container>
                            <ng-container *ngIf="sortDirection === 'desc'">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4 inline-block">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 13.5 12 21m0 0-7.5-7.5M12 21V3" />
                                </svg>
                            </ng-container>
                        </span>
                    </th>
                    <th class="bg-gray-100 border-b border-gray-300 font-normal text-sm p-2 text-start cursor-pointer" (click)="sortRequests('reporter')">
                        {{ 'requestManagement.reporter' | translate }}
                        <span *ngIf="sortColumn === 'reporter'">
                            <ng-container *ngIf="sortDirection === 'asc'">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4 inline-block">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18" />
                                </svg>
                            </ng-container>
                            <ng-container *ngIf="sortDirection === 'desc'">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4 inline-block">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 13.5 12 21m0 0-7.5-7.5M12 21V3" />
                                </svg>
                            </ng-container>
                        </span>
                    </th>
                    <th class="bg-gray-100 border-b border-gray-300 font-normal text-sm p-2 text-start cursor-pointer" (click)="sortRequests('assignee')">
                        {{ 'requestManagement.assignee' | translate }}
                        <span *ngIf="sortColumn === 'assignee'">
                            <ng-container *ngIf="sortDirection === 'asc'">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4 inline-block">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18" />
                                </svg>
                            </ng-container>
                            <ng-container *ngIf="sortDirection === 'desc'">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4 inline-block">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 13.5 12 21m0 0-7.5-7.5M12 21V3" />
                                </svg>
                            </ng-container>
                        </span>
                    </th>
                    <th class="bg-gray-100 border-b border-gray-300 font-normal text-base text-end">
<!--                        <div *ngIf="filterMenu" class="absolute right-0 left-0 top-0 bottom-0 bg-zinc-900 opacity-20" (click)="filterMenu = !filterMenu"></div>-->
                        <div class="relative inline-block">
                            <button (click)="filterMenu = !filterMenu" class="text-white rounded-md px-3 py-1.5 font-medium content-end tracking-widest cursor-pointer hover:bg-gray-50" data-cy="new-request-button">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 inline text-slate-700">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75" />
                                </svg>
                            </button>

                            <div *ngIf="filterMenu" class="absolute right-1 mt-2 w-64 rounded-lg bg-gray-100 shadow-lg ring-1 ring-black/5 focus:outline-none" role="menu" aria-orientation="vertical" aria-labelledby="user-menu" tabindex="-1">
                                <div class="grid gap-x-3 z-10 p-5 text-left">
                                    <p class="font-medium mb-3">User</p>
                                    <div class="py-1 mb-3 cursor-pointer bg-gray-50 text-slate-700 rounded-full text-center border border-gray-300 relative" [class.bg-sky-200]="myRequests" (click)="myRequests = !myRequests; searchRequests2()">My Requests
                                        <div class="absolute rounded-full size-4 bg-white right-2 top-2"></div>
                                        <svg *ngIf="myRequests" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor" class="size-6 absolute right-1 top-1">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
                                        </svg>
                                    </div>
                                    <div class="py-1 mb-3 cursor-pointer bg-gray-50 text-slate-700 rounded-full text-center border border-gray-300 relative" [class.bg-sky-200]="assignedRequests" (click)="assignedRequests = !assignedRequests; searchRequests2()">My Assigned
                                        <div class="absolute rounded-full size-4 bg-white right-2 top-2"></div>
                                        <svg *ngIf="assignedRequests" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor" class="size-6 absolute right-1 top-1">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
                                        </svg>
                                    </div>
                                    <p class="font-medium mb-3">Type</p>
                                    <div class="py-1 mb-3 cursor-pointer bg-gray-50 text-slate-700 rounded-full text-center border border-gray-300 relative" [class.bg-lime-200]="openRequests" (click)="openRequests = !openRequests; searchRequests2()">Open Requests
                                        <div class="absolute rounded-full size-4 bg-white right-2 top-2"></div>
                                        <svg *ngIf="openRequests" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor" class="size-6 absolute right-1 top-1">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
                                        </svg>
                                    </div>
                                    <div class="py-1 cursor-pointer bg-gray-50 text-slate-700 rounded-full text-center border border-gray-300 relative" [class.bg-red-200]="closedRequests" (click)="closedRequests = !closedRequests; searchRequests2()">Closed Requests
                                        <div class="absolute rounded-full size-4 bg-white right-2 top-2"></div>
                                        <svg *ngIf="closedRequests" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor" class="size-6 absolute right-1 top-1">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody class="bg-white dark:bg-slate-800" data-cy="request-list">
                <tr *ngFor="let request of requests | userRequests:user; let last = last" (click)="navigateToRequest(request.id)" class="hover:bg-sky-50 hover:cursor-pointer">
                    <td class="border-gray-300 font-normal text-slate-700 text-sm p-2" [class.border-b]="!last">#{{request.id}}</td>
                    <td class="border-gray-300 font-normal text-sky-500 text-sm p-2" [class.border-b]="!last">{{request.summary}}</td>
                    <td class="border-gray-300 font-normal text-slate-700 text-sm p-2" [class.border-b]="!last">{{request.type | requestTypeTransform}}</td>
                    <td class="border-gray-300 font-normal text-slate-700 text-sm p-2" [class.border-b]="!last">
                        <span class="rounded-full text-white px-3 py-1 font-normal whitespace-nowrap"
                              [class.bg-teal-500]="request.status === 'NEW'"
                              [class.bg-lime-600]="request.status === 'ACCEPTED' || request.status === 'READY_FOR_RELEASE' || request.status === 'PUBLISHED'"
                              [class.bg-red-400]="request.status === 'REJECTED' || request.status === 'APPEAL_REJECTED'"
                              [class.bg-amber-400]="request.status === 'CLARIFICATION_REQUESTED' || request.status === 'UNDER_APPEAL' || request.status === 'APPEAL_CLARIFICATION_REQUESTED'"
                              [class.bg-blue-400]="request.status === 'IN_PROGRESS'"
                              [class.bg-slate-400]="request.status === 'ON_HOLD'"
                              [class.bg-rose-400]="request.status === 'CLOSED' || request.status === 'WITHDRAWN'">{{request.status | statusTransform}}</span>
                    </td>
                    <td class="border-gray-300 font-normal text-slate-700 text-sm p-2" [class.border-b]="!last">{{request.updated | date:'yyyy/MM/dd':'UTC'}}</td>
                    <td class="border-gray-300 font-normal text-slate-700 text-sm p-2" [class.border-b]="!last">{{ getDisplayName(request.reporter) }}</td>
                    <td class="border-gray-300 font-normal text-slate-700 text-sm p-2" [class.border-b]="!last">
                        <ng-container *ngIf="request.assignee"><span class="text-slate-700">{{ getDisplayName(request.assignee) }}</span></ng-container>
                        <ng-container *ngIf="!request.assignee"><span class="text-slate-700">unassigned</span></ng-container>
                    </td>
                    <td class="border-gray-300 font-normal text-slate-700 text-end" [class.border-b]="!last">
                        <i class="fas fa-times text-2xl text-red-500 me-3" (click)="deleteOption = request; $event.stopPropagation()"></i>
                    </td>
                </tr>
                <tr *ngIf="!requests?.length && !requestLoading">
                    <td colspan="8" class="text-center text-gray-500 py-4">{{ 'requestManagement.noRequests' | translate }}</td>
                </tr>
                <tr *ngIf="requestLoading">
                    <td colspan="8" class="text-center text-gray-500 py-4">{{ 'requestManagement.retrieving' | translate }}</td>
                </tr>
            </tbody>
        </table>
    </div>
    <ng-container *ngIf="!requestLoading">
        <div class="grid grid-cols-8 m-5">
            <div class="col-span-2 m-3"></div>
            <div class="col-span-4 m-3 text-center">
                <button class="rounded-md bg-slate-400 text-white px-3 py-1.5 font-medium content-end tracking-widest cursor-pointer hover:bg-slate-500 disabled:bg-slate-300" disabled [disabled]="totalRequests <= visibleRequests" (click)="loadMore()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 inline text-slate-200 me-2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 13.5 12 21m0 0-7.5-7.5M12 21V3" />
                    </svg>{{ 'requestManagement.loadMoreButton' | translate }}</button>
            </div>
            <div class="col-span-2 me-3 justify-self-end">
                <h2 class="text-base text-gray-500">{{ 'requestManagement.showing' | translate:{visible:  requests?.length ? requests.length : 0, total: totalRequests} }}</h2>
            </div>
        </div>
    </ng-container>
</div>

<div *ngIf="deleteOption">
    <div class="relative z-10" aria-labelledby="dialog-title" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-gray-500/75 transition-opacity" aria-hidden="true"></div>
        <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
            <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
                <div class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div class="mx-auto flex size-12 shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:size-10">
                                <svg class="size-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />
                                </svg>
                            </div>
                            <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                                <h3 class="text-base font-semibold text-gray-900" id="dialog-title">{{ 'requestManagement.deleteTitle' | translate:{id: deleteOption.id} }}</h3>
                                <div class="mt-2">
                                    <p class="text-sm text-gray-500">{{ 'requestManagement.confirmDelete' | translate }}</p>
                                    <p class="pt-3 text-center text-sky-600">{{deleteOption.summary}}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 px-3 py-3 sm:flex sm:flex-row-reverse">
                        <button type="button" class="inline-flex justify-center rounded-md bg-red-500 px-3 py-2 text-sm font-medium text-white hover:bg-red-600 hover:cursor-pointer sm:ml-3 sm:w-auto" (click)="deleteRequest(deleteOption)">{{ 'requestManagement.deleteButton' | translate }}</button>
                        <button type="button" class="mt-3 inline-flex justify-center rounded-md bg-white px-3 py-2 text-sm font-medium ring-1 ring-gray-300 ring-inset hover:bg-gray-50 hover:cursor-pointer sm:mt-0 sm:w-auto" (click)="deleteOption = null">{{ 'requestManagement.cancelButton' | translate }}</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
