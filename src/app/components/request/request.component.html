<button class="rounded-md bg-slate-400 text-white px-3 py-1.5 absolute top-18 left-6 text-sm font-medium content-end tracking-widest cursor-pointer hover:bg-slate-500" (click)="navigateBack()">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 inline text-slate-200 me-2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
    </svg>{{ 'request.backButton' | translate }}</button>
<form #requestForm="ngForm" (ngSubmit)="saveRequest(requestForm)" class="overflow-auto text-sm mt-12" data-cy="request-form">
    <ng-container *ngIf="request">
        <div class="grid grid-cols-12 my-5">
            <div class="col-span-2 ms-5">
            </div>
            <div class="col-span-8">
                <ng-container *ngIf="request?.id">
                    <div class="w-full justify-self-center">
                        <div class="border border-gray-300 rounded-lg bg-sky-50 flex justify-between items-center">
                            <div class="font-normal text-slate-700 text-sm p-2 pr-0 pl-0 ms-2">#{{request.id}}</div>
                            <div class="font-normal text-slate-700 text-sm p-2 pr-0">{{request.type | requestTypeTransform}}</div>
                            <div class="font-normal text-slate-700 text-sm p-2 pr-0">
                                <span
                                    class="rounded-full text-white text-sm px-3 py-1 font-normal tracking-widest whitespace-nowrap"
                                    [class.bg-teal-500]="request.status === 'NEW'"
                                    [class.bg-lime-600]="request.status === 'ACCEPTED' || request.status === 'READY_FOR_RELEASE' || request.status === 'PUBLISHED'"
                                    [class.bg-red-400]="request.status === 'REJECTED' || request.status === 'APPEAL_REJECTED'"
                                    [class.bg-amber-400]="request.status === 'CLARIFICATION_REQUESTED' || request.status === 'UNDER_APPEAL' || request.status === 'APPEAL_CLARIFICATION_REQUESTED'"
                                    [class.bg-blue-400]="request.status === 'IN_PROGRESS'"
                                    [class.bg-slate-400]="request.status === 'ON_HOLD'"
                                    [class.bg-rose-400]="request.status === 'CLOSED' || request.status === 'WITHDRAWN'">{{request.status
                                    | statusTransform}}</span>
                            </div>
                            <div class="font-normal text-slate-700 text-sm p-2 pr-0">{{request.updated | date:'yyyy/MM/dd':'UTC'}}</div>
                            <div class="font-normal text-slate-700 text-sm p-2 relative inline-block">
                                <div *ngIf="!isStaff(user)" class="pr-1"><label class="text-base text-slate-700 font-medium">{{ 'request.labels.reporter' | translate }}:</label>&nbsp;<span>{{ getDisplayName(request.reporter) }}</span></div>
                                <label *ngIf="isStaff(user)" for="reporter" class="text-base text-slate-700 font-medium">{{ 'request.labels.reporter' | translate }}&nbsp;</label>
                                <div *ngIf="isStaff(user)" class="flex items-center rounded-md px-3 border bg-white border-gray-300 inline-block">
                                    <input type="text" name="Reporter" id="reporter" [value]="getReporterDisplayValue()" class="grow py-1.5 text-slate-700 placeholder:text-gray-400 focus:outline-none sm:text-sm/6 font-medium" [placeholder]="'requestManagement.typeToSearch' | translate" (input)="onReporterInput($event)" (focus)="onReporterFocus($event)" (blur)="onReporterBlur($event)">
                                </div>
                                <div *ngIf="showReporterTypeahead && reporterTypeaheadResults.length > 0" class="absolute z-50 w-3/4 mt-1 -right-2 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto">
                                    <div *ngFor="let reporter of reporterTypeaheadResults" class="px-3 py-2 hover:bg-gray-100 cursor-pointer text-sm text-slate-700 border-b border-gray-100 last:border-b-0" (click)="selectReporterResult(reporter)">
                                        {{ getDisplayFromUserObject(reporter) }}
                                    </div>
                                </div>
                            </div>
                            <div class="font-normal text-slate-700 text-sm py-1 me-1 relative inline-block">
                                <div *ngIf="!isStaff(user)" class="pr-1"><label class="text-base text-slate-700 font-medium">{{ 'request.labels.assignee' | translate }}:</label>&nbsp;<span>{{ getAssigneeDisplayValue() != '' ? getAssigneeDisplayValue() : 'Unassigned' }}</span></div>
                                <label *ngIf="isStaff(user)" for="assignee" class="text-base text-slate-700 font-medium">{{ 'request.labels.assignee' | translate }}&nbsp;</label>
                                <div *ngIf="isStaff(user)" class="flex items-center rounded-md px-3 border bg-white border-gray-300 inline-block">
                                    <input type="text" name="Assignee" id="assignee" [value]="getAssigneeDisplayValue()" class="grow py-1.5 text-slate-700 placeholder:text-gray-400 focus:outline-none sm:text-sm/6 font-medium" [placeholder]="'requestManagement.typeToSearch' | translate" [class.disabled:text-gray-400]="!isStaff(user)" (input)="onAssigneeInput($event)" (focus)="onAssigneeFocus($event)" (blur)="onAssigneeBlur($event)">
                                </div>
                                <div *ngIf="showAssigneeTypeahead && assigneeTypeaheadResults.length > 0" class="absolute z-50 w-3/4 mt-1 -right-2 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto">
                                    <div *ngFor="let assignee of assigneeTypeaheadResults" class="px-3 py-2 hover:bg-gray-100 cursor-pointer text-sm text-slate-700 border-b border-gray-100 last:border-b-0" (click)="selectAssigneeResult(assignee)">
                                        {{ getDisplayFromUserObject(assignee) }}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="border border-gray-300 rounded-lg bg-sky-50 flex justify-between items-center mt-1">
                            <div class="font-normal text-slate-700 text-sm p-2 pr-0 pl-0 ms-2">
                                <label for="summary" class="text-base text-slate-700 font-medium">{{ 'request.labels.summary' | translate }}:</label>&nbsp;
                                <span>{{request.summary}}</span>
                            </div>
                        </div>
                    </div>
                </ng-container>
                <ng-container *ngIf="!request?.id">
                    <h2 class="text-xl text-slate-700 text-center">{{ 'request.newRequest' | translate }}</h2>
                </ng-container>
            </div>
            <div class="col-span-2 justify-self-end">
            </div>
        </div>

        <div *ngIf="request.id" class="grid w-2/3 justify-self-center my-5">
            <div class="grid grid-cols-12">
                <div class="col-span-2">
                    <button class="rounded-md bg-blue-400 hover:bg-blue-500 text-white px-3 py-1.5 font-medium content-end tracking-widest cursor-pointer" type="button" (click)="displayWorkflowDiagram = true">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 inline text-blue-200 me-2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 7.125C2.25 6.504 2.754 6 3.375 6h6c.621 0 1.125.504 1.125 1.125v3.75c0 .621-.504 1.125-1.125 1.125h-6a1.125 1.125 0 0 1-1.125-1.125v-3.75ZM14.25 8.625c0-.621.504-1.125 1.125-1.125h5.25c.621 0 1.125.504 1.125 1.125v8.25c0 .621-.504 1.125-1.125 1.125h-5.25a1.125 1.125 0 0 1-1.125-1.125v-8.25ZM3.75 16.125c0-.621.504-1.125 1.125-1.125h5.25c.621 0 1.125.504 1.125 1.125v2.25c0 .621-.504 1.125-1.125 1.125h-5.25a1.125 1.125 0 0 1-1.125-1.125v-2.25Z" />
                        </svg>{{ 'request.workflowButton' | translate }}</button>
                    <ng-container *ngIf="displayWorkflowDiagram">
                        <div class="relative z-10" aria-labelledby="dialog-title" role="dialog" aria-modal="true" (click)="displayWorkflowDiagram = false">
                            <div class="fixed inset-0 bg-gray-500/75 transition-opacity" aria-hidden="true"></div>
                            <div class="fixed inset-0 z-10 w-screen overflow-y-auto content-center justify-items-center">
                                <img src="images/workflow.png" class="rounded-lg">
                            </div>
                        </div>
                    </ng-container>
                </div>
                <div class="col-span-10">
                    <ng-container *ngIf="isStaff(user)">
                        <div class="flex flex-wrap justify-end gap-y-4">
                            <button class="rounded-md bg-rose-400 hover:bg-rose-500 text-white px-3 py-1.5 font-medium content-end tracking-widest ms-5 cursor-pointer" type="button" (click)="moveTask('WITHDRAWN')">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 inline text-rose-200 me-2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
                                </svg>{{ 'request.workflow.withdrawn' | translate }}</button>
                            <button class="rounded-md bg-red-400 hover:bg-red-500 text-white px-3 py-1.5 font-medium content-end tracking-widest ms-5 cursor-pointer" type="button" (click)="moveTask('REJECTED')">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 inline text-red-200 me-2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
                                </svg>{{ 'request.workflow.rejected' | translate }}</button>
                            <ng-container *ngIf="request.status === 'NEW'">
                                <button class="rounded-md bg-lime-600 hover:bg-lime-700 text-white px-3 py-1.5 font-medium content-end tracking-widest ms-5 cursor-pointer" type="button" (click)="moveTask('ACCEPTED')">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 inline text-lime-400 me-2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
                                    </svg>{{ 'request.workflow.accepted' | translate }}</button>
                            </ng-container>
                            <ng-container *ngIf="request.status === 'ACCEPTED'">
                                <button class="rounded-md bg-amber-400 hover:bg-amber-500 text-white px-3 py-1.5 font-medium content-end tracking-widest ms-5 cursor-pointer" type="button" (click)="moveTask('CLARIFICATION_REQUESTED')">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 inline text-amber-200 me-2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
                                    </svg>{{ 'request.workflow.clarification' | translate }}</button>
                                <button class="rounded-md bg-blue-400 hover:bg-blue-500 text-white px-3 py-1.5 font-medium content-end tracking-widest ms-5 cursor-pointer" type="button" (click)="moveTask('IN_PROGRESS')">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 inline text-blue-200 me-2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
                                    </svg>{{ 'request.workflow.inProgress' | translate }}</button>
                            </ng-container>
                            <ng-container *ngIf="request.status === 'CLARIFICATION_REQUESTED'">
                                <button class="rounded-md bg-blue-400 hover:bg-blue-500 text-white px-3 py-1.5 font-medium content-end tracking-widest ms-5 cursor-pointer" type="button" (click)="moveTask('IN_PROGRESS')">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 inline text-blue-200 me-2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
                                    </svg>{{ 'request.workflow.inProgress' | translate }}</button>
                            </ng-container>
                            <ng-container *ngIf="request.status === 'IN_PROGRESS'">
                                <button class="rounded-md bg-rose-400 hover:bg-rose-500 text-white px-3 py-1.5 font-medium content-end tracking-widest ms-5 cursor-pointer" type="button" (click)="moveTask('CLOSED')">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 inline text-rose-200 me-2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
                                    </svg>{{ 'request.workflow.closed' | translate }}</button>
                                <button class="rounded-md bg-slate-400 hover:bg-slate-500 text-white px-3 py-1.5 font-medium content-end tracking-widest ms-5 cursor-pointer" type="button" (click)="moveTask('ON_HOLD')">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 inline text-slate-200 me-2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
                                    </svg>{{ 'request.workflow.onHold' | translate }}</button>
                                <button class="rounded-md bg-amber-400 hover:bg-amber-500 text-white px-3 py-1.5 font-medium content-end tracking-widest ms-5 cursor-pointer" type="button" (click)="moveTask('CLARIFICATION_REQUESTED')">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 inline text-amber-200 me-2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
                                    </svg>{{ 'request.workflow.clarification' | translate }}</button>
                                <button class="rounded-md bg-lime-600 hover:bg-lime-700 text-white px-3 py-1.5 font-medium content-end tracking-widest ms-5 cursor-pointer" type="button" (click)="moveTask('READY_FOR_RELEASE')">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 inline text-lime-400 me-2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
                                    </svg>{{ 'request.workflow.readyForRelease' | translate }}</button>
                            </ng-container>
                            <ng-container *ngIf="request.status === 'ON_HOLD'">
                                <button class="rounded-md bg-blue-400 hover:bg-blue-500 text-white px-3 py-1.5 font-medium content-end tracking-widest ms-5 cursor-pointer" type="button" (click)="moveTask('IN_PROGRESS')">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 inline text-blue-200 me-2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
                                    </svg>{{ 'request.workflow.inProgress' | translate }}</button>
                            </ng-container>
                            <ng-container *ngIf="request.status === 'READY_FOR_RELEASE'">
                                <button class="rounded-md bg-lime-600 hover:bg-lime-700 text-white px-3 py-1.5 font-medium content-end tracking-widest ms-5 cursor-pointer" type="button" (click)="moveTask('PUBLISHED')">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 inline text-lime-400 me-2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
                                    </svg>{{ 'request.workflow.published' | translate }}</button>
                            </ng-container>
                            <ng-container *ngIf="request.status === 'PUBLISHED'">
                                <button class="rounded-md bg-lime-600 hover:bg-lime-700 text-white px-3 py-1.5 font-medium content-end tracking-widest ms-5 cursor-pointer" type="button" (click)="moveTask('READY_FOR_RELEASE')">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 inline text-lime-400 me-2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
                                    </svg>{{ 'request.workflow.readyForRelease' | translate }}</button>
                            </ng-container>
                            <ng-container *ngIf="request.status === 'REJECTED'">
                                <button class="rounded-md bg-amber-400 hover:bg-amber-500 text-white px-3 py-1.5 font-medium content-end tracking-widest ms-5 cursor-pointer" type="button" (click)="moveTask('UNDER_APPEAL')">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 inline text-amber-200 me-2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
                                    </svg>{{ 'request.workflow.appealed' | translate }}</button>
                            </ng-container>
                            <ng-container *ngIf="request.status === 'UNDER_APPEAL'">
                                <button class="rounded-md bg-red-400 hover:bg-red-500 text-white px-3 py-1.5 font-medium content-end tracking-widest ms-5 cursor-pointer" type="button" (click)="moveTask('APPEAL_REJECTED')">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 inline text-red-200 me-2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
                                    </svg>{{ 'request.workflow.appealRejected' | translate }}</button>
                                <button class="rounded-md bg-amber-400 hover:bg-amber-500 text-white px-3 py-1.5 font-medium content-end tracking-widest ms-5 cursor-pointer" type="button" (click)="moveTask('APPEAL_CLARIFICATION_REQUESTED')">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 inline text-amber-200 me-2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
                                    </svg>{{ 'request.workflow.appealClarification' | translate }}</button>
                                <button class="rounded-md bg-blue-400 hover:bg-blue-500 text-white px-3 py-1.5 font-medium content-end tracking-widest ms-5 cursor-pointer" type="button" (click)="moveTask('IN_PROGRESS')">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 inline text-blue-200 me-2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
                                    </svg>{{ 'request.workflow.inProgress' | translate }}</button>
                            </ng-container>
                            <ng-container *ngIf="request.status === 'APPEAL_CLARIFICATION_REQUESTED'">
                                <button class="rounded-md bg-amber-400 hover:bg-amber-500 text-white px-3 py-1.5 font-medium content-end tracking-widest ms-5 cursor-pointer" type="button" (click)="moveTask('UNDER_APPEAL')">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 inline text-amber-200 me-2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
                                    </svg>{{ 'request.workflow.appealed' | translate }}</button>
                                <button class="rounded-md bg-blue-400 hover:bg-blue-500 text-white px-3 py-1.5 font-medium content-end tracking-widest ms-5 cursor-pointer" type="button" (click)="moveTask('IN_PROGRESS')">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 inline text-blue-200 me-2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
                                    </svg>{{ 'request.workflow.inProgress' | translate }}</button>
                            </ng-container>
                        </div>
                    </ng-container>
                </div>
            </div>
        </div>

        <div class="border border-gray-300 grid grid-cols-2 gap-6 w-2/3 justify-self-center mt-5 mb-3 bg-sky-50 rounded-lg p-3">
            <div>
                <label for="summary" class="text-sm text-slate-700 font-medium">{{ 'request.labels.summary' | translate }}<span class="text-red-500 ps-1">*</span></label>
                <div class="mt-2">
                    <div class="flex items-center rounded-md px-3 border bg-white border-gray-300" [class.disabled:bg-gray-100]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                        <input type="text" [disabled]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" [(ngModel)]="request.summary" name="Summary" id="summary" #summaryInput="ngModel" required class="grow py-1.5 placeholder:text-gray-400 text-slate-700 focus:outline-none sm:text-sm/6 font-medium" [class.disabled:text-gray-400]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" data-cy="summary-input" />
                    </div>
                    <div *ngIf="summaryInput.invalid && summaryInput.touched" class="text-red-500 text-sm">{{ 'request.validation.summaryRequired' | translate }}</div>
                </div>
            </div>
            <div>
                <label for="type" class="text-sm text-slate-700 font-medium">{{ 'request.labels.type' | translate }}<span class="text-red-500 ps-1">*</span></label>
                <div class="mt-2">
                    <div class="flex items-center rounded-md px-3 border border-gray-300 bg-lime-50" [class.disabled:bg-lime-100]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                        <select name="Type" id="type" class="grow py-1.5 text-slate-700 placeholder:text-gray-400 focus:outline-none sm:text-sm/6 h-9 font-medium" [disabled]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" [(ngModel)]="request.type" [class.disabled:text-gray-400]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" #typeInput="ngModel" required data-cy="type-select">
                            <option [value]="'add-concept'">{{ 'request.typeOptions.addConcept' | translate }}</option>
                            <option [value]="'add-description'">{{ 'request.typeOptions.addDescription' | translate }}</option>
                            <option [value]="'add-relationship'">{{ 'request.typeOptions.addRelationship' | translate }}</option>
                            <option [value]="'add-refset'">{{ 'request.typeOptions.addRefset' | translate }}</option>
                            <option [value]="'change-description'">{{ 'request.typeOptions.changeDescription' | translate }}</option>
                            <option [value]="'change-relationship'">{{ 'request.typeOptions.changeRelationship' | translate }}</option>
                            <option [value]="'change-refset'">{{ 'request.typeOptions.changeRefset' | translate }}</option>
                            <option [value]="'inactivate-description'">{{ 'request.typeOptions.inactivateDescription' | translate }}</option>
                            <option [value]="'inactivate-relationship'">{{ 'request.typeOptions.inactivateRelationship' | translate }}</option>
                            <option [value]="'other'">{{ 'request.typeOptions.other' | translate }}</option>
                        </select>
                    </div>
                    <div *ngIf="typeInput.invalid && typeInput.touched" class="text-red-500 text-sm">{{ 'request.validation.typeRequired' | translate }}</div>
                </div>
            </div>
            <div>
                <label for="languageRefset" class="text-sm text-slate-700 font-medium">{{ 'request.labels.languageRefset' | translate }}</label>
                <div class="mt-2">
                    <div class="flex items-center rounded-md px-3 border bg-white border-gray-300" [class.disabled:bg-gray-100]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                        <select name="Language Refset" id="languageRefset" class="grow py-1.5 text-slate-700 placeholder:text-gray-400 focus:outline-none sm:text-sm/6 h-9 font-medium" [disabled]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" [(ngModel)]="request.languageRefset" [class.disabled:text-gray-400]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" data-cy="language-refset-select">
                            <option>{{ 'request.languageRefsets.none' | translate }}</option>
                            <option>{{ 'request.languageRefsets.belgianDutch' | translate }}</option>
                            <option>{{ 'request.languageRefsets.belgianGerman' | translate }}</option>
                            <option>{{ 'request.languageRefsets.belgianFrench' | translate }}</option>
                            <option>{{ 'request.languageRefsets.danish' | translate }}</option>
                            <option>{{ 'request.languageRefsets.french' | translate }}</option>
                            <option>{{ 'request.languageRefsets.ieEnglish' | translate }}</option>
                            <option>{{ 'request.languageRefsets.gbEnglish' | translate }}</option>
                            <option>{{ 'request.languageRefsets.korean' | translate }}</option>
                            <option>{{ 'request.languageRefsets.maori' | translate }}</option>
                            <option>{{ 'request.languageRefsets.norwegianBokmal' | translate }}</option>
                            <option>{{ 'request.languageRefsets.norwegianNynorsk' | translate }}</option>
                            <option>{{ 'request.languageRefsets.nzEnglish' | translate }}</option>
                            <option>{{ 'request.languageRefsets.swedish' | translate }}</option>
                            <option>{{ 'request.languageRefsets.swissGerman' | translate }}</option>
                            <option>{{ 'request.languageRefsets.swissItalian' | translate }}</option>
                            <option>{{ 'request.languageRefsets.swissFrench' | translate }}</option>
                            <option>{{ 'request.languageRefsets.usEnglish' | translate }}</option>
                        </select>
                    </div>
                </div>
            </div>
            <div>
                <label for="contextRefset" class="text-sm text-slate-700 font-medium">{{ 'request.labels.contextRefset' | translate }}</label>
                <div class="mt-2">
                    <div class="flex items-center rounded-md px-3 border bg-white border-gray-300" [class.disabled:bg-gray-100]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                        <select name="Context Refset" id="contextRefset" [disabled]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" [(ngModel)]="request.contextRefset" class="grow py-1.5 text-slate-700 placeholder:text-gray-400 focus:outline-none sm:text-sm/6 h-9 font-medium" [class.disabled:text-gray-400]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" data-cy="context-refset-select">
                            <option>{{ 'request.contextRefsets.none' | translate }}</option>
                            <option>{{ 'request.contextRefsets.beGpDutch' | translate }}</option>
                            <option>{{ 'request.contextRefsets.beGpFrench' | translate }}</option>
                            <option>{{ 'request.contextRefsets.nzPatientFriendly' | translate }}</option>
                            <option>{{ 'request.contextRefsets.seChiefComplaints' | translate }}</option>
                            <option>{{ 'request.contextRefsets.seDoseUnitAbbr' | translate }}</option>
                            <option>{{ 'request.contextRefsets.seLabMedicine' | translate }}</option>
                            <option>{{ 'request.contextRefsets.seDoseUnitPlural' | translate }}</option>
                            <option>{{ 'request.contextRefsets.seMedicationProf' | translate }}</option>
                            <option>{{ 'request.contextRefsets.seMedicationCommon' | translate }}</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="col-span-2 border-b border-gray-300 -mx-3"></div>

            <ng-container *ngIf="request.type === 'add-concept'">
                <div>
                    <label for="newFSN" class="text-sm text-slate-700 font-medium">{{ 'request.labels.newFsn' | translate }}<span class="text-red-500 ps-1">*</span></label>
                    <div class="mt-2">
                        <div class="flex items-center rounded-md px-3 border bg-white border-gray-300" [class.disabled:bg-gray-100]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                            <input type="text" name="New FSN" id="newFSN" [disabled]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" [(ngModel)]="request.newFSN" #newFSNInput="ngModel" required class="grow py-1.5 text-slate-700 placeholder:text-gray-400 focus:outline-none sm:text-sm/6 font-medium" [class.disabled:text-gray-400]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" data-cy="new-fsn-input">
                        </div>
                        <div *ngIf="newFSNInput.invalid && newFSNInput.touched" class="text-red-500 text-sm">{{ 'request.validation.newFsnRequired' | translate }}</div>
                    </div>
                </div>
                <div>
                    <label for="newPT" class="text-sm text-slate-700 font-medium">{{ 'request.labels.newPreferredTerm' | translate }}<span class="text-red-500 ps-1">*</span></label>
                    <div class="mt-2">
                        <div class="flex items-center rounded-md px-3 border bg-white border-gray-300" [class.disabled:bg-gray-100]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                            <input type="text" name="New Preferred Term" id="newPT" [disabled]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" [(ngModel)]="request.newPT" #newPTInput="ngModel" required class="grow py-1.5 text-slate-700 placeholder:text-gray-400 focus:outline-none sm:text-sm/6 font-medium" [class.disabled:text-gray-400]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" data-cy="new-pt-input">
                        </div>
                        <div *ngIf="newPTInput.invalid && newPTInput.touched" class="text-red-500 text-sm">{{ 'request.validation.newPtRequired' | translate }}</div>
                    </div>
                </div>
                <div>
                    <label for="newSynonyms" class="text-sm text-slate-700 font-medium">{{ 'request.labels.newSynonyms' | translate }}</label>
                    <div class="mt-2">
                        <div class="flex items-center rounded-md px-3 border bg-white border-gray-300" [class.disabled:bg-gray-100]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                            <input type="text" name="New Synonyms" id="newSynonyms" [disabled]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" [(ngModel)]="request.newSynonyms" class="grow py-1.5 text-slate-700 placeholder:text-gray-400 focus:outline-none sm:text-sm/6 font-medium" [class.disabled:text-gray-400]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" data-cy="new-synonyms-textarea"/>
                        </div>
                    </div>
                </div>
                <div>
                    <label for="parentConcept" class="text-sm text-slate-700 font-medium">{{ 'request.labels.parentConcept' | translate }}<span class="text-red-500 ps-1">*</span></label>
                    <div class="mt-2 relative">
                        <div class="flex items-center rounded-md px-3 border bg-white border-gray-300" [class.disabled:bg-gray-100]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5 me-2">
                                <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11ZM2 9a7 7 0 1 1 12.452 4.391l3.328 3.329a.75.75 0 1 1-1.06 1.06l-3.329-3.328A7 7 0 0 1 2 9Z" clip-rule="evenodd" />
                            </svg>
                            <input type="text" name="Parent Concept" id="parentConcept" [disabled]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" [(ngModel)]="request.parentConcept" #parentConceptInput="ngModel" required class="grow py-1.5 text-slate-700 placeholder:text-gray-400 focus:outline-none sm:text-sm/6 font-medium" [placeholder]="'requestManagement.typeToSearch' | translate" [class.disabled:text-gray-400]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" (input)="onParentConceptInput($event)">
                        </div>
                        <div *ngIf="showTypeahead && typeaheadResults.length > 0" class="absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto">
                            <div *ngFor="let result of typeaheadResults" class="px-3 py-2 hover:bg-gray-100 cursor-pointer text-sm text-slate-700 border-b border-gray-100 last:border-b-0" (click)="selectTypeaheadResult(result, 'parentConcept')">
                                {{ result }}
                            </div>
                        </div>

                        <div *ngIf="parentConceptInput.invalid && parentConceptInput.touched" class="text-red-500 text-sm">{{ 'request.validation.parentConceptRequired' | translate }}</div>
                    </div>
                </div>

                <div class="col-span-2 border-b border-gray-300 -mx-3"></div>
            </ng-container>

            <ng-container
                *ngIf="request.type === 'add-description' || request.type === 'add-relationship' || request.type === 'change-description' || request.type === 'change-relationship' || request.type === 'inactivate-description' || request.type === 'inactivate-relationship'">
                <div class="col-span-2">
                    <label for="concept" class="text-sm text-slate-700 font-medium">{{ 'request.labels.concept' | translate }}</label>
                    <div class="mt-2 relative">
                        <div class="flex items-center rounded-md px-3 border bg-white border-gray-300" [class.disabled:bg-gray-100]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5 me-2">
                                <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11ZM2 9a7 7 0 1 1 12.452 4.391l3.328 3.329a.75.75 0 1 1-1.06 1.06l-3.329-3.328A7 7 0 0 1 2 9Z" clip-rule="evenodd" />
                            </svg>
                            <input type="text" name="Concept" id="concept" [disabled]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))"  [(ngModel)]="request.concept" class="grow py-1.5 text-slate-700 placeholder:text-gray-400 focus:outline-none sm:text-sm/6 font-medium" [placeholder]="'requestManagement.typeToSearch' | translate" [class.disabled:text-gray-400]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" (input)="onParentConceptInput($event)">
                        </div>
                        <div *ngIf="showTypeahead && typeaheadResults.length > 0" class="absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto">
                            <div *ngFor="let result of typeaheadResults" class="px-3 py-2 hover:bg-gray-100 cursor-pointer text-sm text-slate-700 border-b border-gray-100 last:border-b-0" (click)="selectTypeaheadResult(result, 'concept')">
                                {{ result }}
                            </div>
                        </div>
                    </div>
                </div>
                <div>
                    <label for="conceptId" class="text-sm text-slate-700 font-medium">{{ 'request.labels.conceptId' | translate }}<span class="text-red-500 ps-1">*</span></label>
                    <div class="mt-2">
                        <div class="flex items-center rounded-md px-3 border bg-white border-gray-300" [class.disabled:bg-gray-100]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                            <input type="text" name="Concept ID" id="conceptId" [disabled]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" [(ngModel)]="request.conceptId" #conceptIdInput="ngModel" required class="grow py-1.5 text-slate-700 placeholder:text-gray-400 focus:outline-none sm:text-sm/6 font-medium" [class.disabled:text-gray-400]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" data-cy="concept-id-input">
                        </div>
                        <div *ngIf="conceptIdInput.invalid && conceptIdInput.touched" class="text-red-500 text-sm">{{ 'request.validation.conceptIdRequired' | translate }}</div>
                    </div>
                </div>
                <div>
                    <label for="conceptName" class="text-sm text-slate-700 font-medium">{{ 'request.labels.conceptName' | translate }}<span class="text-red-500 ps-1">*</span></label>
                    <div class="mt-2">
                        <div class="flex items-center rounded-md px-3 border bg-white border-gray-300" [class.disabled:bg-gray-100]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                            <input type="text" name="Concept Name" id="conceptName" [disabled]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" [(ngModel)]="request.conceptName" #conceptNameInput="ngModel" required class="grow py-1.5 text-slate-700 placeholder:text-gray-400 focus:outline-none sm:text-sm/6 font-medium" [class.disabled:text-gray-400]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                        </div>
                        <div *ngIf="conceptNameInput.invalid && conceptNameInput.touched" class="text-red-500 text-sm">{{ 'request.validation.conceptNameRequired' | translate }}</div>
                    </div>
                </div>
                <ng-container *ngIf="request.type === 'add-description'">
                    <div class="col-span-2">
                        <label for="newDescription" class="text-sm text-slate-700 font-medium">{{ 'request.labels.newDescription' | translate }}<span class="text-red-500 ps-1">*</span></label>
                        <div class="mt-2">
                            <div class="flex items-center rounded-md px-3 border bg-white border-gray-300" [class.disabled:bg-gray-100]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                                <input type="text" name="New Description" id="newDescription" [disabled]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" [(ngModel)]="request.newDescription" #newDescriptionInput="ngModel" required class="grow py-1.5 text-slate-700 placeholder:text-gray-400 focus:outline-none sm:text-sm/6 font-medium" [class.disabled:text-gray-400]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" data-cy="new-description-input">
                            </div>
                            <div *ngIf="newDescriptionInput.invalid && newDescriptionInput.touched" class="text-red-500 text-sm">{{ 'request.validation.newDescriptionRequired' | translate }}</div>
                        </div>
                    </div>
                </ng-container>

                <ng-container *ngIf="request.type === 'add-relationship'">
                    <div>
                        <label for="relationshipType" class="text-sm text-slate-700 font-medium">{{ 'request.labels.relationshipType' | translate }}<span class="text-red-500 ps-1">*</span></label>
                        <div class="mt-2">
                            <div class="flex items-center rounded-md px-3 border bg-white border-gray-300" [class.disabled:bg-gray-100]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                                <select name="Relationship Type" id="relationshipType" #relationshipTypeInput="ngModel" [disabled]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" [(ngModel)]="request.relationshipType" required class="grow py-1.5 text-slate-700 placeholder:text-gray-400 focus:outline-none sm:text-sm/6 h-9 font-medium" [class.disabled:text-gray-400]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" data-cy="context-refset-select">
                                    <option>{{ 'request.relationshipType.isA' | translate }}</option>
                                    <option>{{ 'request.relationshipType.associatedMorphology' | translate }}</option>
                                    <option>{{ 'request.relationshipType.findingSite' | translate }}</option>
                                    <option>{{ 'request.relationshipType.procedureSite' | translate }}</option>
                                    <option>{{ 'request.relationshipType.unknown' | translate }}</option>
                                    <option>{{ 'request.relationshipType.other' | translate }}</option>
                                </select>
                            </div>
                            <div *ngIf="relationshipTypeInput.invalid && relationshipTypeInput.touched" class="text-red-500 text-sm">{{ 'request.validation.relationshipTypeRequired' | translate }}</div>
                        </div>
                    </div>
                    <div>
                        <label for="relationshipTarget" class="text-sm text-slate-700 font-medium">{{ 'request.labels.relationshipTarget' | translate }}<span class="text-red-500 ps-1">*</span></label>
                        <div class="mt-2 relative">
                            <div class="flex items-center rounded-md px-3 border bg-white border-gray-300" [class.disabled:bg-gray-100]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5 me-2">
                                    <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11ZM2 9a7 7 0 1 1 12.452 4.391l3.328 3.329a.75.75 0 1 1-1.06 1.06l-3.329-3.328A7 7 0 0 1 2 9Z" clip-rule="evenodd" />
                                </svg>
                                <input type="text" name="Relationship Target" id="relationshipTarget" #relationshipTargetInput="ngModel" required [disabled]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" [(ngModel)]="request.relationshipTarget" class="grow py-1.5 text-slate-700 placeholder:text-gray-400 focus:outline-none sm:text-sm/6 font-medium" [placeholder]="'requestManagement.typeToSearch' | translate" [class.disabled:text-gray-400]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" (input)="onParentConceptInput($event)">
                            </div>
                            <div *ngIf="showTypeahead && typeaheadResults.length > 0" class="absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto">
                                <div *ngFor="let result of typeaheadResults" class="px-3 py-2 hover:bg-gray-100 cursor-pointer text-sm text-slate-700 border-b border-gray-100 last:border-b-0" (click)="selectTypeaheadResult(result, 'relationshipTarget')">
                                    {{ result }}
                                </div>
                            </div>
                            <div *ngIf="relationshipTargetInput.invalid && relationshipTargetInput.touched" class="text-red-500 text-sm">{{ 'request.validation.relationshipTargetRequired' | translate }}</div>
                        </div>
                    </div>
                </ng-container>

                <ng-container *ngIf="request.type === 'change-description'">
                    <div>
                        <label for="existingDescription" class="text-sm text-slate-700 font-medium">{{ 'request.labels.existingDescription' | translate }}<span class="text-red-500 ps-1">*</span></label>
                        <div class="mt-2">
                            <div class="flex items-center rounded-md px-3 border bg-white border-gray-300" [class.disabled:bg-gray-100]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                                <input type="text" name="Exisiting Description" id="existingDescription" [disabled]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" [(ngModel)]="request.existingDescription" #existingDescriptionInput="ngModel" required class="grow py-1.5 text-slate-700 placeholder:text-gray-400 focus:outline-none sm:text-sm/6 font-medium" [class.disabled:text-gray-400]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                            </div>
                            <div *ngIf="existingDescriptionInput.invalid && existingDescriptionInput.touched" class="text-red-500 text-sm">{{ 'request.validation.existingDescriptionRequired' | translate }}</div>
                        </div>
                    </div>
                    <div>
                        <label for="newChangeDescription" class="text-sm text-slate-700 font-medium">{{ 'request.labels.newDescription' | translate }}<span class="text-red-500 ps-1">*</span></label>
                        <div class="mt-2">
                            <div class="flex items-center rounded-md px-3 border bg-white border-gray-300" [class.disabled:bg-gray-100]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                                <input type="text" name="New Description" id="newChangeDescription" [disabled]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" [(ngModel)]="request.newDescription" #newDescriptionInput="ngModel" required class="grow py-1.5 text-slate-700 placeholder:text-gray-400 focus:outline-none sm:text-sm/6 font-medium" [class.disabled:text-gray-400]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                            </div>
                            <div *ngIf="newDescriptionInput.invalid && newDescriptionInput.touched" class="text-red-500 text-sm">{{ 'request.validation.newDescriptionRequired' | translate }}</div>
                        </div>
                    </div>
                </ng-container>

                <ng-container *ngIf="request.type === 'change-relationship'">
                    <div class="col-span-2">
                        <label for="existingRelationship" class="text-sm text-slate-700 font-medium">{{ 'request.labels.existingRelationship' | translate }}<span class="text-red-500 ps-1">*</span></label>
                        <div class="mt-2">
                            <div class="flex items-center rounded-md px-3 border bg-white border-gray-300" [class.disabled:bg-gray-100]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                                <input type="text" name="Exisiting Relationship" id="existingRelationship" [disabled]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" [(ngModel)]="request.existingRelationship" #existingRelationshipInput="ngModel" required class="grow py-1.5 text-slate-700 placeholder:text-gray-400 focus:outline-none sm:text-sm/6 font-medium" [class.disabled:text-gray-400]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                            </div>
                            <div *ngIf="existingRelationshipInput.invalid && existingRelationshipInput.touched" class="text-red-500 text-sm">{{ 'request.validation.existingRelationshipRequired' | translate }}</div>
                        </div>
                    </div>
                    <div>
                        <label for="relationshipType" class="text-sm text-slate-700 font-medium">{{ 'request.labels.relationshipType' | translate }}<span class="text-red-500 ps-1">*</span></label>
                        <div class="mt-2">
                            <div class="flex items-center rounded-md px-3 border bg-white border-gray-300" [class.disabled:bg-gray-100]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                                <input type="text" name="Relationship Type" id="relationshipType" [disabled]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" [(ngModel)]="request.relationshipType" #relationshipTypeInput="ngModel" required class="grow py-1.5 text-slate-700 placeholder:text-gray-400 focus:outline-none sm:text-sm/6 font-medium" [class.disabled:text-gray-400]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                            </div>
                            <div *ngIf="relationshipTypeInput.invalid && relationshipTypeInput.touched" class="text-red-500 text-sm">{{ 'request.validation.relationshipTypeRequired' | translate }}</div>
                        </div>
                    </div>
                    <div>
                        <label for="relationshipTarget" class="text-sm text-slate-700 font-medium">{{ 'request.labels.relationshipTarget' | translate }}<span class="text-red-500 ps-1">*</span></label>
                        <div class="mt-2">
                            <div class="flex items-center rounded-md px-3 border bg-white border-gray-300" [class.disabled:bg-gray-100]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5 me-2">
                                    <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11ZM2 9a7 7 0 1 1 12.452 4.391l3.328 3.329a.75.75 0 1 1-1.06 1.06l-3.329-3.328A7 7 0 0 1 2 9Z" clip-rule="evenodd" />
                                </svg>
                                <input type="text" name="Relationship Target" id="relationshipTarget" [disabled]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" [(ngModel)]="request.relationshipTarget" #relationshipTargetInput="ngModel" required class="grow py-1.5 text-slate-700 placeholder:text-gray-400 focus:outline-none sm:text-sm/6 font-medium" [placeholder]="'requestManagement.typeToSearch' | translate" [class.disabled:text-gray-400]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                            </div>
                            <div *ngIf="relationshipTargetInput.invalid && relationshipTargetInput.touched" class="text-red-500 text-sm">{{ 'request.validation.relationshipTargetRequired' | translate }}</div>
                        </div>
                    </div>
                </ng-container>

                <ng-container *ngIf="request.type === 'inactivate-description'">
                    <div class="col-span-2">
                        <label for="inactivateExistingDescription" class="text-sm text-slate-700 font-medium">{{ 'request.labels.existingDescription' | translate }}<span class="text-red-500 ps-1">*</span></label>
                        <div class="mt-2">
                            <div class="flex items-center rounded-md px-3 border bg-white border-gray-300" [class.disabled:bg-gray-100]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                                <input type="text" name="Exisiting Description" id="inactivateExistingDescription" [disabled]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" [(ngModel)]="request.existingDescription" #existingDescriptionInput="ngModel" required class="grow py-1.5 text-slate-700 placeholder:text-gray-400 focus:outline-none sm:text-sm/6 font-medium" [class.disabled:text-gray-400]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                            </div>
                            <div *ngIf="existingDescriptionInput.invalid && existingDescriptionInput.touched" class="text-red-500 text-sm">{{ 'request.validation.existingDescriptionRequired' | translate }}</div>
                        </div>
                    </div>
                </ng-container>

                <ng-container *ngIf="request.type === 'inactivate-relationship'">
                    <div class="col-span-2">
                        <label for="inactivateExistingRelationship" class="text-sm text-slate-700 font-medium">{{ 'request.labels.existingRelationship' | translate }}<span class="text-red-500 ps-1">*</span></label>
                        <div class="mt-2">
                            <div class="flex items-center rounded-md px-3 border bg-white border-gray-300" [class.disabled:bg-gray-100]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                                <input type="text" name="Exisiting Relationship" id="inactivateExistingRelationship" [disabled]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" [(ngModel)]="request.existingRelationship" #existingRelationshipInput="ngModel" required class="grow py-1.5 text-slate-700 placeholder:text-gray-400 focus:outline-none sm:text-sm/6 font-medium" [class.disabled:text-gray-400]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                            </div>
                            <div *ngIf="existingRelationshipInput.invalid && existingRelationshipInput.touched" class="text-red-500 text-sm">{{ 'request.validation.existingRelationshipRequired' | translate }}</div>
                        </div>
                    </div>
                </ng-container>

                <div class="col-span-2 border-b border-gray-300 -mx-3"></div>
            </ng-container>

            <ng-container *ngIf="request.type === 'add-refset' || request.type === 'change-refset'">
                <div class="col-span-2">
                    <label for="memberConceptIds" class="text-sm text-slate-700 font-medium">{{ 'request.labels.membersList' | translate }}</label>
                    <div class="mt-2">
                        <div class="flex items-center rounded-md p-3 border bg-white border-gray-300" [class.disabled:bg-gray-100]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                            <textarea type="text" name="Member Concept Ids" id="memberConceptIds" [disabled]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" [(ngModel)]="request.memberConceptIds" class="grow text-slate-700 placeholder:text-gray-400 focus:outline-none sm:text-sm/6 h-32 font-medium" [class.disabled:text-gray-400]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))"></textarea>
                        </div>
                    </div>
                </div>
                <div class="col-span-2">
                    <label for="eclQuery" class="text-sm text-slate-700 font-medium">{{ 'request.labels.eclQuery' | translate }}</label>
                    <div class="mt-2">
                        <div class="flex items-center rounded-md p-3 border bg-white border-gray-300" [class.disabled:bg-gray-100]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                            <textarea type="text" name="ECL Query" id="eclQuery" [disabled]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" [(ngModel)]="request.eclQuery" class="grow text-slate-700 placeholder:text-gray-400 focus:outline-none sm:text-sm/6 h-32 font-medium" [class.disabled:text-gray-400]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))"></textarea>
                        </div>
                    </div>
                </div>
            </ng-container>

            <div class="col-span-2">
                <label for="justification" class="text-sm text-slate-700 font-medium">{{ 'request.labels.justification' | translate }}</label>
                <div class="mt-2">
                    <div class="flex items-center rounded-md p-3 border bg-white border-gray-300" [class.disabled:bg-gray-100]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                        <textarea type="text" name="Justification" id="justification" [disabled]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" [(ngModel)]="request.justification" class="grow text-slate-700 placeholder:text-gray-400 focus:outline-none sm:text-sm/6 h-32 font-medium" [class.disabled:text-gray-400]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))"></textarea>
                    </div>
                </div>
            </div>
            <div class="col-span-2">
                <label for="reference" class="text-sm text-slate-700 font-medium">{{ 'request.labels.reference' | translate }}</label>
                <div class="mt-2">
                    <div class="flex items-center rounded-md p-3 border bg-white border-gray-300" [class.disabled:bg-gray-100]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))">
                        <textarea type="text" name="Reference" id="reference" [disabled]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))" [(ngModel)]="request.reference" class="grow text-slate-700 placeholder:text-gray-400 focus:outline-none sm:text-sm/6 h-32 font-medium" [class.disabled:text-gray-400]="mode === ModeType.VIEW && !isStaff(user) && (!isRequestOwner() || (isRequestOwner() && request.status !== 'NEW'))"></textarea>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid w-2/3 justify-self-center my-5" *ngIf="mode === ModeType.NEW">
            <div class="justify-self-end">
                <button class="rounded-md bg-red-400 hover:bg-red-500 text-white px-3 py-1.5 font-medium content-end tracking-widest me-5 cursor-pointer" (click)="resetForm(requestForm)" type="button">{{ 'request.resetButton' | translate }}</button>
                <button class="rounded-md bg-lime-600 hover:bg-lime-700 text-white px-3 py-1.5 font-medium content-end tracking-widest cursor-pointer" type="submit" data-cy="submit-button" [disabled]="!request.type || request.type.trim() === '' || !request.summary || request.summary.trim() === ''" [class.disabled:bg-slate-300]="!request.type || request.type.trim() === '' || !request.summary || request.summary.trim() === ''">{{ 'request.submitButton' | translate }}</button>
            </div>
        </div>

        <div class="grid w-2/3 justify-self-center my-5" *ngIf="mode !== ModeType.NEW && (isStaff(user) || (isUser(user) && request.status === 'NEW'))">
            <div class="justify-self-end">
                <button class="rounded-md bg-lime-600 hover:bg-lime-700 text-white px-3 py-1.5 font-medium content-end tracking-widest cursor-pointer" [disabled]="!hasRequestChanged()" [class.disabled:bg-slate-300]="!hasRequestChanged()" (click)="updateRequest(requestForm)" data-cy="save-button">{{ 'request.saveButton' | translate }}</button>
            </div>
        </div>

        <ng-container *ngIf="mode !== ModeType.NEW">
            <div class="grid w-2/3 justify-self-center my-5">
                <h2 class="text-xl text-slate-700">{{ 'request.comments' | translate }}</h2>
                <p *ngIf="requestComments.length === 0" class="p-5 text-center text-gray-500">{{ 'request.noComments' | translate }}</p>
                <ng-container *ngFor="let comment of requestComments">
                    <div class="my-3">
                        <ng-container *ngIf="user && user.login === comment.user">
                            <p class="ms-3 font-medium">{{ getDisplayName(comment.user) }} <span class="text-gray-500 text-sm font-normal ms-2">{{comment.created | date:'yyyy/MM/dd, h:mm a':'UTC'}}</span></p>
                            <i class="fa-solid fa-trash float-right mt-2 mr-2 text-red-400" (click)="deleteOption = comment; $event.stopPropagation()"></i>
                            <div class="border border-lime-300 bg-lime-100 rounded-lg">
                                <p class="p-3">{{comment.body}}</p>
                            </div>
                        </ng-container>
                        <ng-container *ngIf="user &&user.login !== comment.user">
                            <p class="ms-3 font-medium">{{ getDisplayName(comment.user) }} <span class="text-gray-500 text-sm font-normal ms-2">{{comment.created | date:'yyyy/MM/dd, h:mm a':'UTC'}}</span></p>
                            <div class="border border-sky-200 bg-sky-100 rounded-lg">
                                <p class="p-3">{{comment.body}}</p>
                            </div>
                        </ng-container>
                    </div>
                </ng-container>

                <div class="flex items-center rounded-md p-3 border border-gray-300 my-5">
                    <textarea type="text" name="comment" class="grow text-slate-700 placeholder:text-gray-400 focus:outline-none sm:text-sm/6 h-24 font-medium" [placeholder]="'request.commentPlaceholder' | translate" [(ngModel)]="comment" data-cy="comment-textarea"></textarea>
                </div>

                <div class="justify-self-end">
                    <button class="rounded-md bg-lime-600 hover:bg-lime-700 text-white px-3 py-1.5 font-medium content-end tracking-widest cursor-pointer justify-self-start" type="button" (click)="postComment()" data-cy="add-comment-button">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 inline text-lime-400 me-2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8.625 9.75a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375m-13.5 3.01c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.184-4.183a1.14 1.14 0 0 1 .778-.332 48.294 48.294 0 0 0 5.83-.498c1.585-.233 2.708-1.626 2.708-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z" />
                        </svg>{{ 'request.addCommentButton' | translate }}</button>
                </div>
            </div>
        </ng-container>
    </ng-container>
</form>

<div *ngIf="deleteOption">
    <div class="relative z-10" aria-labelledby="dialog-title" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-gray-500/75 transition-opacity" aria-hidden="true"></div>
        <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
            <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
                <div class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div class="mx-auto flex size-12 shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:size-10">
                                <svg class="size-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />
                                </svg>
                            </div>
                            <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                                <h3 class="text-base font-semibold text-gray-900" id="dialog-title">{{ 'requestManagement.deleteCommentTitle' | translate}}</h3>
                                <div class="mt-2">
                                    <p class="text-sm text-gray-500">{{ 'requestManagement.confirmDeleteComment' | translate }}</p>
                                    <p class="pt-3 text-center text-sky-600">{{deleteOption.body}}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 px-3 py-3 sm:flex sm:flex-row-reverse">
                        <button type="button" class="inline-flex justify-center rounded-md bg-red-500 px-3 py-2 text-sm font-medium text-white hover:bg-red-600 hover:cursor-pointer sm:ml-3 sm:w-auto" (click)="deleteComment(deleteOption.id)">{{ 'requestManagement.deleteButton' | translate }}</button>
                        <button type="button" class="mt-3 inline-flex justify-center rounded-md bg-white px-3 py-2 text-sm font-medium ring-1 ring-gray-300 ring-inset hover:bg-gray-50 hover:cursor-pointer sm:mt-0 sm:w-auto" (click)="deleteOption = null">{{ 'requestManagement.cancelButton' | translate }}</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
